<div class="game-header">
    <div class="header-content">
        <div class="back-nav">
            <a href="/FUNDamentals/games" class="back-btn">
                <span class="material-icons">arrow_back</span>
                Back to Games
            </a>
        </div>
        <div class="game-title-section">
            <h1>ðŸ’° Budget Blitz</h1>
            <p class="game-subtitle">Monthly Budget Challenge - Master the 50/30/20 rule under pressure!</p>
        </div>
    </div>
</div>

<div id="budget-blitz-game" class="game-container">
    <div class="game-content-wrapper">
        <div class="card">
        <h3>Budget Challenge: Monthly Simulation</h3>
        <p style="margin-bottom: 20px; color: #666;">You have Â£2,000 for the month. Make smart decisions to stay within budget while handling unexpected situations!</p>
        
            <div class="budget-overview">
                <div class="budget-stat">
                    <span class="label">Monthly Income:</span>
                    <span class="amount" id="monthly-income">Â£2,000</span>
                </div>
                <div class="budget-stat">
                    <span class="label">Remaining Budget:</span>
                    <span class="amount" id="remaining-budget">Â£2,000</span>
                </div>
                <div class="budget-stat">
                    <span class="label">Day:</span>
                    <span class="amount" id="current-day">1</span>
                </div>
            </div>

            <div class="budget-breakdown">
                <div class="category">
                    <span class="category-name">Needs (50%)</span>
                    <div class="progress-bar">
                        <div class="progress" id="needs-progress" style="width: 0%"></div>
                    </div>
                    <span class="spent" id="needs-spent">Â£0 / Â£1,000</span>
                </div>
                <div class="category">
                    <span class="category-name">Wants (30%)</span>
                    <div class="progress-bar">
                        <div class="progress" id="wants-progress" style="width: 0%"></div>
                    </div>
                    <span class="spent" id="wants-spent">Â£0 / Â£600</span>
                </div>
                <div class="category">
                    <span class="category-name">Savings (20%)</span>
                    <div class="progress-bar">
                        <div class="progress" id="savings-progress" style="width: 0%"></div>
                    </div>
                    <span class="spent" id="savings-spent">Â£0 / Â£400</span>
                </div>
            </div>

            <div class="game-story">
                <div class="scenario" id="current-scenario">
                    <h4 id="scenario-title">Welcome to Budget Blitz!</h4>
                    <p id="scenario-description">You've just received your Â£2,000 monthly salary. Time to make some financial decisions and master budgeting!</p>
                    <div class="scenario-choices" id="scenario-choices">
                        <button class="choice-btn" onclick="startBudgetChallenge()">Start Challenge!</button>
                    </div>
                </div>
            </div>

            <div class="game-results" id="game-results" style="display: none;">
                <h4>Challenge Complete!</h4>
                <div class="final-score">
                    <h5>Your Final Score: <span id="final-score">0</span>/12</h5>
                    <p id="score-message"></p>
                    <div class="budget-summary">
                        <p><strong>Final Budget Remaining:</strong> Â£<span id="final-budget">0</span></p>
                    </div>
                </div>
                <div class="game-actions">
                    <button class="btn primary" onclick="startBudgetChallenge()">Play Again</button>
                    <a href="/FUNDamentals/games" class="btn secondary">Back to Games</a>
                </div>
            </div>
    </div>
</div>

<style>
.game-header {
    background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
    border-radius: var(--radius);
    padding: 2rem;
    margin-bottom: 2rem;
    border: 1px solid #e5e7eb;
}

.header-content {
    max-width: 100%;
}

.back-nav {
    margin-bottom: 1rem;
}

.back-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--text-secondary);
    text-decoration: none;
    font-size: 0.95rem;
    transition: all 0.2s ease;
    padding: 0.5rem 1rem;
    border-radius: var(--radius-sm);
}

.back-btn:hover {
    background: rgba(98, 54, 255, 0.1);
    color: var(--primary);
}

.back-btn .material-icons {
    font-size: 1.2rem;
}

.game-title-section h1 {
    font-size: 2.5rem;
    font-weight: 700;
    color: var(--text-main);
    margin: 0 0 0.5rem 0;
}

.game-subtitle {
    font-size: 1.2rem;
    color: var(--text-secondary);
    margin: 0;
}

.game-container {
    min-height: 600px;
    overflow: visible;
}

.game-content-wrapper {
    max-width: 1000px;
    margin: 0 auto;
    padding: 0 20px;
}

.game-content-wrapper {
    max-width: 1000px;
    margin: 0 auto;
    padding: 0 20px;
}

.card {
    background: #ffffff;
    border-radius: 15px;
    padding: 30px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    margin-bottom: 20px;
}

.card h3 {
    color: #2c3e50;
    margin-bottom: 20px;
    font-size: 1.8em;
}

.budget-overview {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 25px;
    padding: 20px;
    background: white;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
}

.budget-stat {
    text-align: center;
    padding: 15px;
    border-radius: 8px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
}

.budget-stat .label {
    display: block;
    font-size: 0.9em;
    opacity: 0.9;
    margin-bottom: 5px;
}

.budget-stat .amount {
    display: block;
    font-size: 1.4em;
    font-weight: bold;
}

.budget-breakdown {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 15px;
    margin-bottom: 25px;
}

.category {
    padding: 15px;
    border-radius: 10px;
    background: white;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
}

.category-name {
    font-weight: 600;
    color: #2c3e50;
    margin-bottom: 8px;
    display: block;
}

.progress-bar {
    background: #e9ecef;
    border-radius: 20px;
    height: 20px;
    overflow: hidden;
    margin-bottom: 8px;
}

.progress {
    height: 100%;
    border-radius: 20px;
    transition: width 0.5s ease;
}

#needs-progress { background: #dc3545; }
#wants-progress { background: #ffc107; }
#savings-progress { background: #28a745; }

.spent {
    font-size: 0.9em;
    color: #6c757d;
    font-weight: 500;
}

.game-story {
    background: white;
    border-radius: 10px;
    padding: 25px;
    margin-bottom: 20px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
}

.scenario h4 {
    color: #2c3e50;
    margin-bottom: 15px;
    font-size: 1.3em;
}

.scenario p {
    color: #555;
    line-height: 1.6;
    margin-bottom: 20px;
}

.scenario-choices {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.choice-btn {
    padding: 15px 20px;
    border: 2px solid #667eea;
    background: white;
    color: #667eea;
    border-radius: 10px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
    text-align: left;
}

.choice-btn:hover {
    background: #667eea;
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
}

.game-results {
    background: white;
    border-radius: 10px;
    padding: 25px;
    text-align: center;
}

.final-score h5 {
    color: #2c3e50;
    font-size: 1.5em;
    margin-bottom: 10px;
}

.final-score span {
    color: #667eea;
}

.budget-summary {
    margin: 20px 0;
    padding: 15px;
    background: #f1f5f9;
    border-radius: 8px;
}

.game-actions {
    display: flex;
    gap: 15px;
    justify-content: center;
    margin-top: 25px;
}

.btn {
    padding: 12px 30px;
    border: none;
    border-radius: 25px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
    display: inline-block;
}

.btn.primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
}

.btn.primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
}

.btn.secondary {
    background: #6c757d;
    color: white;
}

.btn.secondary:hover {
    background: #5a6268;
}

@media (max-width: 768px) {
    .game-title-section h1 {
        font-size: 2rem;
    }
    
    .card {
        padding: 20px;
    }
    
    .budget-overview {
        grid-template-columns: 1fr;
        gap: 15px;
    }
    
    .budget-breakdown {
        grid-template-columns: 1fr;
        gap: 10px;
    }
    
    .game-actions {
        flex-direction: column;
    }
    
    .btn {
        width: 100%;
        text-align: center;
    }
}
</style>

<script>
console.log('Budget Blitz game loaded');

let gameScore = 0;
let gameData = {
    totalBudget: 2000,
    remaining: 2000,
    needs: { allocated: 1000, spent: 0 },
    wants: { allocated: 600, spent: 0 },
    savings: { allocated: 400, spent: 0 }
};
let currentScenarioIndex = 0;
let gameCompleted = false;

const gameScenarios = [
    {
        title: "Monthly Rent Due",
        description: "Your rent of Â£800 is due today. You must pay this essential expense.",
        choices: [
            { text: "Pay rent (Â£800)", cost: 800, category: 'needs', points: 2, feedback: "Great! Rent is a necessary expense." }
        ],
        autoSelect: true
    },
    {
        title: "Grocery Shopping",
        description: "You need to buy groceries for the week. You have several options:",
        choices: [
            { text: "Shop at budget supermarket (Â£60)", cost: 60, category: 'needs', points: 2, feedback: "Smart choice! Budget shopping helps stretch your money." },
            { text: "Shop at premium store (Â£100)", cost: 100, category: 'needs', points: 1, feedback: "Food is essential, but you could save by shopping smarter." },
            { text: "Order expensive takeaways all week (Â£150)", cost: 150, category: 'wants', points: 0, feedback: "This is convenient but costly - consider cooking more at home." }
        ]
    },
    {
        title: "Friend's Birthday Party",
        description: "Your friend is having a birthday party at an expensive restaurant. What do you do?",
        choices: [
            { text: "Go to dinner and split the bill (Â£40)", cost: 40, category: 'wants', points: 2, feedback: "Nice balance of socializing within budget!" },
            { text: "Suggest a cheaper alternative activity (Â£15)", cost: 15, category: 'wants', points: 2, feedback: "Creative thinking! You can still celebrate affordably." },
            { text: "Skip the party to save money (Â£0)", cost: 0, category: 'none', points: 1, feedback: "Saving is good, but don't forget to enjoy life sometimes!" },
            { text: "Go anyway and order the most expensive dish (Â£80)", cost: 80, category: 'wants', points: 0, feedback: "Be careful not to overspend on social events." }
        ]
    },
    {
        title: "Car Breakdown",
        description: "Your car breaks down and needs repairs. This is unexpected but necessary.",
        choices: [
            { text: "Get it repaired immediately (Â£200)", cost: 200, category: 'needs', points: 2, feedback: "Good decision - transportation is essential for work." },
            { text: "Use public transport temporarily (Â£50)", cost: 50, category: 'needs', points: 2, feedback: "Smart temporary solution while you save for repairs!" },
            { text: "Ignore it and walk everywhere (Â£0)", cost: 0, category: 'none', points: 0, feedback: "This might work short-term but could cause bigger problems." }
        ]
    },
    {
        title: "Flash Sale Alert!",
        description: "Your favorite clothing store has a 50% off sale. You see a jacket you've wanted:",
        choices: [
            { text: "Buy the jacket - it's a great deal! (Â£60)", cost: 60, category: 'wants', points: 1, feedback: "It's a good deal, but make sure it fits your wants budget." },
            { text: "Wait and think about it for a week (Â£0)", cost: 0, category: 'none', points: 2, feedback: "Excellent restraint! Waiting helps avoid impulse purchases." },
            { text: "Buy the jacket and matching accessories (Â£120)", cost: 120, category: 'wants', points: 0, feedback: "Careful! Sales can lead to overspending on things you don't need." }
        ]
    },
    {
        title: "Emergency Fund Decision",
        description: "You have some money left over this month. What should you do with it?",
        choices: [
            { text: "Put it all in savings (Â£200)", cost: 200, category: 'savings', points: 2, feedback: "Perfect! Building your emergency fund is crucial." },
            { text: "Save half, treat yourself with the rest (Â£100 each)", cost: 100, category: 'savings', points: 2, feedback: "Great balance of saving and enjoying your money!", extraCost: 100, extraCategory: 'wants' },
            { text: "Spend it all on entertainment (Â£200)", cost: 200, category: 'wants', points: 0, feedback: "You're missing a chance to build financial security." }
        ]
    }
];

function startBudgetChallenge() {
    resetGameState();
    currentScenarioIndex = 0;
    showNextScenario();
}

function resetGameState() {
    gameData = {
        totalBudget: 2000,
        remaining: 2000,
        needs: { allocated: 1000, spent: 0 },
        wants: { allocated: 600, spent: 0 },
        savings: { allocated: 400, spent: 0 }
    };
    gameScore = 0;
    gameCompleted = false;
    updateBudgetDisplay();
    
    document.getElementById('game-results').style.display = 'none';
    document.getElementById('current-scenario').style.display = 'block';
}

function showNextScenario() {
    if (currentScenarioIndex >= gameScenarios.length) {
        completeGame();
        return;
    }

    const scenario = gameScenarios[currentScenarioIndex];
    document.getElementById('scenario-title').textContent = scenario.title;
    document.getElementById('scenario-description').textContent = scenario.description;
    document.getElementById('current-day').textContent = currentScenarioIndex + 1;

    const choicesContainer = document.getElementById('scenario-choices');
    choicesContainer.innerHTML = '';

    if (scenario.autoSelect) {
        const choice = scenario.choices[0];
        const button = document.createElement('button');
        button.className = 'choice-btn';
        button.textContent = choice.text;
        button.onclick = () => makeChoice(choice);
        choicesContainer.appendChild(button);
    } else {
        scenario.choices.forEach(choice => {
            const button = document.createElement('button');
            button.className = 'choice-btn';
            button.textContent = choice.text;
            button.onclick = () => makeChoice(choice);
            choicesContainer.appendChild(button);
        });
    }
}

function makeChoice(choice) {
    processExpense(choice.cost, choice.category);
    
    if (choice.extraCost) {
        processExpense(choice.extraCost, choice.extraCategory);
    }
    
    gameScore += choice.points;
    
    showChoiceFeedback(choice.feedback, choice.points);
    
    setTimeout(() => {
        currentScenarioIndex++;
        showNextScenario();
    }, 2000);
}

function processExpense(cost, category) {
    if (category === 'none') return;
    
    gameData.remaining -= cost;
    
    if (category === 'needs') {
        gameData.needs.spent += cost;
    } else if (category === 'wants') {
        gameData.wants.spent += cost;
    } else if (category === 'savings') {
        gameData.savings.spent += cost;
    }
    
    updateBudgetDisplay();
}

function updateBudgetDisplay() {
    document.getElementById('remaining-budget').textContent = `Â£${gameData.remaining}`;
    
    updateCategoryProgress('needs');
    updateCategoryProgress('wants');
    updateCategoryProgress('savings');
}

function updateCategoryProgress(category) {
    const data = gameData[category];
    const percentage = Math.min((data.spent / data.allocated) * 100, 100);
    const progressBar = document.getElementById(`${category}-progress`);
    const spentText = document.getElementById(`${category}-spent`);
    
    progressBar.style.width = `${percentage}%`;
    spentText.textContent = `Â£${data.spent} / Â£${data.allocated}`;
    
    if (data.spent > data.allocated) {
        progressBar.style.background = '#dc3545';
        spentText.style.color = '#dc3545';
    }
}

function showChoiceFeedback(feedback, points) {
    const scenarioDiv = document.getElementById('current-scenario');
    const feedbackDiv = document.createElement('div');
    feedbackDiv.style.marginTop = '15px';
    feedbackDiv.style.padding = '15px';
    feedbackDiv.style.borderRadius = '8px';
    feedbackDiv.style.fontWeight = '600';
    
    if (points === 2) {
        feedbackDiv.style.background = '#d4edda';
        feedbackDiv.style.color = '#155724';
        feedbackDiv.innerHTML = `âœ… ${feedback} (+${points} points)`;
    } else if (points === 1) {
        feedbackDiv.style.background = '#fff3cd';
        feedbackDiv.style.color = '#856404';
        feedbackDiv.innerHTML = `âš ï¸ ${feedback} (+${points} point)`;
    } else {
        feedbackDiv.style.background = '#f8d7da';
        feedbackDiv.style.color = '#721c24';
        feedbackDiv.innerHTML = `âŒ ${feedback} (+${points} points)`;
    }
    
    scenarioDiv.appendChild(feedbackDiv);
}

function completeGame() {
    gameCompleted = true;
    document.getElementById('game-results').style.display = 'block';
    document.getElementById('current-scenario').style.display = 'none';
    
    const finalScore = Math.max(0, gameScore);
    document.getElementById('final-score').textContent = finalScore;
    document.getElementById('final-budget').textContent = gameData.remaining;
    
    const scoreMessage = document.getElementById('score-message');
    if (finalScore >= 10) {
        scoreMessage.textContent = "Excellent! You made great financial decisions throughout the month!";
        scoreMessage.style.color = "#28a745";
    } else if (finalScore >= 7) {
        scoreMessage.textContent = "Good job! You showed solid budgeting skills with room for improvement.";
        scoreMessage.style.color = "#ffc107";
    } else if (finalScore >= 4) {
        scoreMessage.textContent = "Not bad! You're learning, but try to think more carefully about needs vs wants.";
        scoreMessage.style.color = "#fd7e14";
    } else {
        scoreMessage.textContent = "Keep practicing! Budgeting takes time to master - you'll get better!";
        scoreMessage.style.color = "#dc3545";
    }
    
    saveGameResults();
}

function saveGameResults() {
    if (!gameCompleted) return;
    
    const apiData = {
        game_name: 'budget-blitz',
        score: gameScore,
        final_value: gameData.remaining,
        years_played: 0,
        profit_loss: gameData.remaining - gameData.totalBudget
    };
    
    fetch('/FUNDamentals/api/games/score', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(apiData)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            console.log('Budget Blitz score saved successfully:', data);
        } else {
            console.error('Failed to save Budget Blitz score:', data.error);
        }
    })
    .catch(error => {
        console.error('Error saving Budget Blitz score:', error);
    });
}

document.addEventListener('DOMContentLoaded', function() {
    console.log('Budget Blitz game initialized');
});
</script> 